<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø­Ø°Ù Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙˆØ± â€” Ù…Ø¬Ø§Ù†ÙŠ Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±</title>
  <style>
    :root{
      --bg:#0b1220;--card:#121a2a;--muted:#94a3b8;--text:#e2e8f0;--accent:#22c55e;--accent-2:#60a5fa
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;background:linear-gradient(180deg,#0b1220,#0f172a);color:var(--text);min-height:100vh}
    .container{max-width:980px;margin-inline:auto;padding:24px}
    .card{background:var(--card);border:1px solid rgba(255,255,255,.06);border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.25);padding:20px}
    h1{font-size:clamp(22px,3vw,32px);margin:0 0 12px}
    p.lead{color:var(--muted);margin-top:0}
    .uploader{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:18px 0}
    .btn{display:inline-flex;align-items:center;gap:8px;cursor:pointer;border:1px solid rgba(255,255,255,.1);background:#0b1425;color:var(--text);padding:10px 14px;border-radius:14px;font-weight:600}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#16a34a);border-color:transparent;color:#03110a}
    .btn.secondary{background:linear-gradient(135deg,var(--accent-2),#3b82f6);border-color:transparent;color:#061227}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    input[type="file"]{display:none}
    .hint{font-size:13px;color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:880px){.grid{grid-template-columns:1fr 1fr}}
    .panel{background:#0b1425;border:1px dashed rgba(255,255,255,.14);border-radius:16px;padding:14px}
    .preview{display:grid;place-items:center;aspect-ratio:1/1;background:#0a0f1d;border-radius:12px;overflow:hidden}
    .preview img{max-width:100%;height:auto;display:block}
    .footer{margin-top:16px;font-size:12px;color:var(--muted)}
    .progress{height:8px;background:#0a0f1d;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0%;background:linear-gradient(90deg,#22c55e,#3b82f6)}
    .badge{display:inline-block;padding:.3rem .6rem;border-radius:999px;background:#0b1425;border:1px solid rgba(255,255,255,.08);font-size:12px;color:#a5b4fc}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>Ø­Ø°Ù Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙˆØ± â€” Ù…Ø¬Ø§Ù†ÙŠ 100Ùª ÙˆÙŠØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­</h1>
      <p class="lead">Ø­Ù…Ù‘Ù„ ØµÙˆØ±ØªÙƒ ÙˆØ§Ø¶ØºØ· Â«Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©Â». ØªØªÙ… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ù…ØªØµÙØ­Ùƒ â€” Ù„Ø§ ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ùƒ Ù„Ø£ÙŠ Ø®Ø§Ø¯Ù….</p>

      <div class="uploader">
        <label class="btn" for="file-input">ğŸ“ Ø§Ø®ØªØ± ØµÙˆØ±Ø©</label>
        <input id="file-input" type="file" accept="image/*" />
        <button id="remove-btn" class="btn primary" disabled>âœ¨ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©</button>
        <button id="download-btn" class="btn secondary" disabled>â¬‡ï¸ ØªÙ†Ø²ÙŠÙ„ PNG Ø´ÙØ§Ù</button>
        <span id="status" class="badge">Ø¬Ø§Ù‡Ø²</span>
      </div>

      <div class="progress" aria-hidden="true" title="ØªÙ‚Ø¯Ù… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬">
        <div id="progress-bar" class="bar"></div>
      </div>
      <p class="hint">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø£ÙˆÙ„ ØªØ´ØºÙŠÙ„ Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø£Ø·ÙˆÙ„ Ù‚Ù„ÙŠÙ„Ù‹Ø§ Ù„Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ù…ÙŠÙ„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø«Ù… ÙŠØ®Ø²Ù‘Ù†Ù‡.</p>

      <div class="grid">
        <div class="panel">
          <h3>Ø§Ù„Ù…ØµØ¯Ø±</h3>
          <div class="preview" id="src-preview"><span class="hint">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø¨Ø¹Ø¯â€¦</span></div>
        </div>
        <div class="panel">
          <h3>Ø§Ù„Ù†ØªÙŠØ¬Ø© (PNG Ø¨Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ©)</h3>
          <div class="preview" id="out-preview"><span class="hint">â€”</span></div>
        </div>
      </div>

      <div class="footer">
        <p>ÙŠØ¹ØªÙ…Ø¯ Ù‡Ø°Ø§ Ø¹Ù„Ù‰ Ù…ÙƒØªØ¨Ø© <b>@imgly/background-removal</b> Ù…ÙØªÙˆØ­Ø© Ø§Ù„Ù…ØµØ¯Ø±. Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø±Ø®ØµØ© <span dir="ltr">AGPL-3.0</span>.</p>
      </div>
    </div>
  </div>

  <script type="module">
    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† CDN (ESM)
    import removeBackground, { preload } from 'https://unpkg.com/@imgly/background-removal@1.7.0/dist/index.mjs';

    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    const fileInput = document.getElementById('file-input');
    const removeBtn = document.getElementById('remove-btn');
    const downloadBtn = document.getElementById('download-btn');
    const statusEl = document.getElementById('status');
    const progressBar = document.getElementById('progress-bar');
    const srcPreview = document.getElementById('src-preview');
    const outPreview = document.getElementById('out-preview');

    let selectedFile = null;
    let resultBlob = null;

    // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø³Ø¨Ù‚Ù‹Ø§ Ù„Ø¥Ø³Ø±Ø§Ø¹ Ø£ÙˆÙ„ Ø§Ø³ØªØ®Ø¯Ø§Ù…
    preload({
      // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¨Ø¯Ø§Ù„ "device: 'gpu'" Ù„ØªÙØ¹ÙŠÙ„ WebGPU Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù…Ù‡
      // device: 'gpu',
      progress: (key, current, total) => {
        const pct = total ? Math.round((current / total) * 100) : 0;
        progressBar.style.width = pct + '%';
        statusEl.textContent = `ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯: ${pct}%`;
      }
    }).then(() => {
      statusEl.textContent = 'Ø¬Ø§Ù‡Ø²';
      progressBar.style.width = '100%';
      setTimeout(()=>{progressBar.style.width = '0%';}, 1200);
    }).catch(() => {
      statusEl.textContent = 'Ø¬Ø§Ù‡Ø² (ØªØ®Ø·Ù‘ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ø¨Ù‚)';
    });

    fileInput.addEventListener('change', () => {
      const file = fileInput.files && fileInput.files[0];
      if (!file) return;
      selectedFile = file;
      resultBlob = null;
      downloadBtn.disabled = true;
      removeBtn.disabled = false;
      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
      const url = URL.createObjectURL(file);
      srcPreview.innerHTML = `<img alt="Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©" src="${url}">`;
      outPreview.innerHTML = '<span class="hint">Ø¬Ø§Ù‡Ø² Ù„Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©â€¦</span>';
    });

    removeBtn.addEventListener('click', async () => {
      if (!selectedFile) return;
      removeBtn.disabled = true;
      statusEl.textContent = 'Ø¬Ø§Ø±Ù Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ©â€¦';
      outPreview.innerHTML = '<span class="hint">â³ ØªØªÙ… Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­â€¦</span>';

      try {
        // ÙŠÙ…ÙƒÙ†Ùƒ ØªÙ…Ø±ÙŠØ± Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù…Ø«Ù„ Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø®Ø±Ø§Ø¬
        // { output: { format: 'image/png', type: 'foreground' }, device: 'gpu' }
        resultBlob = await removeBackground(selectedFile);
        const outURL = URL.createObjectURL(resultBlob);
        outPreview.innerHTML = `<img alt="Ø§Ù„Ù†ØªÙŠØ¬Ø©" src="${outURL}">`;
        downloadBtn.disabled = false;
        statusEl.textContent = 'ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© âœ”';
      } catch (e) {
        console.error(e);
        statusEl.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ âŒ';
        outPreview.innerHTML = '<span class="hint">ØªØ¹Ø°Ø± Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØµÙˆØ±Ø©.</span>';
      } finally {
        removeBtn.disabled = false;
      }
    });

    downloadBtn.addEventListener('click', () => {
      if (!resultBlob) return;
      const a = document.createElement('a');
      a.href = URL.createObjectURL(resultBlob);
      a.download = 'background-removed.png';
      document.body.appendChild(a);
      a.click();
      a.remove();
    });
  </script>
</body>
</html>
